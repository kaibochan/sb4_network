function get_all_drives()
    all_drives = {}

    names = peripheral.getNames()
    for _, name in ipairs(names) do
        p_type = peripheral.getType(name)
        if p_type == "drive" then
            table.insert(all_drives, peripheral.wrap(name))
        end
    end

    return all_drives
end

function get_all_mount_paths(drives)
    all_mount_paths = {}

    for _, drive in ipairs(drives) do
        table.insert(all_mount_paths, drive.getMountPath())
    end

    return all_mount_paths
end

function scan_all_files(network_paths)
    network_files = {}

    frontier = {}
    for _, path in ipairs(network_paths) do
        table.insert(frontier, path)
    end

    while #frontier ~= 0 do
        for _, f in ipairs(fs.list(frontier[1])) do
            f_path = frontier[1].."/"..f
            if fs.isDir(f_path) then
                table.insert(frontier, f_path)
            else
                table.insert(network_files, f_path)
            end
        end

        table.remove(frontier, 1)
    end

    return network_files
end

function main()
    drives = get_all_drives()
    paths = get_all_mount_paths(drives)
    
    index_file = fs.open("index.dat", "w")
    files = scan_all_files(paths)

    for _, file in ipairs(files) do
        print(file)
    end
end

main()